<div class="container mx-auto mt-4">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-semibold">Loan Application Details - <%= @loan_application.full_name %></h2>
    <%= link_to "Back to List", loan_applications_path, class: "px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600" %>
  </div>

  <!-- Step 1: Customer Information -->
  <div class="bg-white shadow rounded-lg mb-4">
    <div class="flex justify-between items-center px-4 py-2 border-b">
      <h5 class="font-semibold">1. Customer Information</h5>
      <%= link_to "Edit", loan_application_step_path(:customer_info, loan_application_id: @loan_application.id), 
      class: "px-3 py-1 border border-blue-500 text-blue-500 rounded-md text-sm hover:bg-blue-50"
       %>

    </div>
    <div class="p-4 overflow-x-auto">
      <table class="w-full border border-gray-200 text-sm text-center">
        <thead class="bg-gray-200">
          <tr>
            <th class="border px-4 py-2">Full Name</th>
            <th class="border px-4 py-2">Contact Details</th>
            <th class="border px-4 py-2">Identification</th>
            <th class="border px-4 py-2">Employment Status</th>
            <th class="border px-4 py-2">Employer</th>
            <th class="border px-4 py-2">Monthly Income</th>
            <th class="border px-4 py-2">Monthly Expenses</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="border px-4 py-2"><%= @loan_application.full_name %></td>
            <td class="border px-4 py-2"><%= @loan_application.contact_details %></td>
            <td class="border px-4 py-2"><%= @loan_application.identification %></td>
            <td class="border px-4 py-2"><%= @loan_application.employment_status %></td>
            <td class="border px-4 py-2"><%= @loan_application.employer %></td>
            <td class="border px-4 py-2">$<%= number_with_delimiter(@loan_application.monthly_income) if @loan_application.monthly_income %></td>
            <td class="border px-4 py-2">$<%= number_with_delimiter(@loan_application.monthly_expenses) if @loan_application.monthly_expenses %></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Step 2: Loan Details -->
  <% if @loan_application.loan_amount.present? %>
    <div class="bg-white shadow rounded-lg mb-4">
      <div class="flex justify-between items-center px-4 py-2 border-b">
        <h5 class="font-semibold">2. Loan Details</h5>
        <%# <%= link_to "Edit", loan_application_steps_path(loan_application_id: @loan_application.id, id: 'loan_details'), class: "px-3 py-1 border border-blue-500 text-blue-500 rounded-md text-sm hover:bg-blue-50" %>
        
        <%= link_to "Edit", loan_application_step_path(:loan_details, loan_application_id: @loan_application.id), 
          class: "px-3 py-1 border border-blue-500 text-blue-500 rounded-md text-sm hover:bg-blue-50"
        %>

      </div>
      <div class="p-4 overflow-x-auto">
        <table class="w-full border border-gray-200 text-sm text-center">
          <thead class="bg-gray-200">
            <tr>
              <th class="border px-4 py-2">Loan Amount</th>
              <th class="border px-4 py-2">Purpose</th>
              <th class="border px-4 py-2">Tenure</th>
              <th class="border px-4 py-2">Repayment Frequency</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border px-4 py-2">$<%= number_with_delimiter(@loan_application.loan_amount) %></td>
              <td class="border px-4 py-2"><%= @loan_application.purpose %></td>
              <td class="border px-4 py-2"><%= @loan_application.tenure %> months</td>
              <td class="border px-4 py-2"><%= @loan_application.repayment_frequency %></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>

  <!-- Step 3: Financial Analysis -->
  <% if @loan_application.debt_to_income_ratio.present? %>
    <div class="bg-white shadow rounded-lg mb-4">
      <div class="flex justify-between items-center px-4 py-2 border-b">
        <h5 class="font-semibold">3. Financial Analysis</h5>
        <%# <%= link_to "Edit", loan_application_steps_path(loan_application_id: @loan_application.id, id: 'financial_analysis'), class: "px-3 py-1 border border-blue-500 text-blue-500 rounded-md text-sm hover:bg-blue-50" %>
         <%= link_to "Edit", loan_application_step_path(:financial_analysis, loan_application_id: @loan_application.id), 
          class: "px-3 py-1 border border-blue-500 text-blue-500 rounded-md text-sm hover:bg-blue-50"
          %>
      </div>
      <div class="p-4 overflow-x-auto">
        <table class="w-full border border-gray-200 text-sm text-center">
          <thead class="bg-gray-200">
            <tr>
              <th class="border px-4 py-2">Debt-to-Income Ratio</th>
              <th class="border px-4 py-2">Savings</th>
              <th class="border px-4 py-2">Existing Loans</th>
              <th class="border px-4 py-2">Assets</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border px-4 py-2"><%= @loan_application.debt_to_income_ratio %>%</td>
              <td class="border px-4 py-2">$<%= number_with_delimiter(@loan_application.savings) if @loan_application.savings %></td>
              <td class="border px-4 py-2"><%= @loan_application.existing_loans %></td>
              <td class="border px-4 py-2"><%= @loan_application.assets %></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>

   <!-- Step 4: Credit History -->
  <% if @loan_application.credit_score.present? %>
    <div class="bg-white shadow rounded-lg mb-4">
      <div class="flex justify-between items-center px-4 py-2 border-b">
        <h5 class="font-semibold">4. Credit History</h5>
        <%= link_to "Edit", loan_application_step_path(:credit_history, loan_application_id: @loan_application.id), 
          class: "px-3 py-1 border border-blue-500 text-blue-500 rounded-md text-sm hover:bg-blue-50"
        %>
      </div>
      <div class="p-4 overflow-x-auto">
        <table class="w-full border border-gray-200 text-sm text-center">
          <thead class="bg-gray-200">
            <tr>
              <th class="border px-4 py-2">Credit Score</th>
              <th class="border px-4 py-2">Past Behavior</th>
              <th class="border px-4 py-2">Defaults / Late Payments</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border px-4 py-2"><%= @loan_application.credit_score %></td>
              <td class="border px-4 py-2"><%= @loan_application.past_behavior %></td>
              <td class="border px-4 py-2"><%= @loan_application.defaults_late_payments %></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>

   <!-- Step 5: Collateral -->
  <% if @loan_application.collateral_type.present? %>
    <div class="bg-white shadow rounded-lg mb-4">
      <div class="flex justify-between items-center px-4 py-2 border-b">
        <h5 class="font-semibold">5. Collateral</h5>
        <%= link_to "Edit", loan_application_step_path(:collateral, loan_application_id: @loan_application.id), 
          class: "px-3 py-1 border border-blue-500 text-blue-500 rounded-md text-sm hover:bg-blue-50"
        %>
      </div>
      <div class="p-4 overflow-x-auto">
        <table class="w-full border border-gray-200 text-sm text-center">
          <thead class="bg-gray-200">
            <tr>
              <th class="border px-4 py-2">Collateral Type</th>
              <th class="border px-4 py-2">Collateral Valuation</th>
              <th class="border px-4 py-2">Ownership Documents</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border px-4 py-2"><%= @loan_application.collateral_type %></td>
              <td class="border px-4 py-2">$<%= number_with_delimiter(@loan_application.collateral_valuation) if @loan_application.collateral_valuation %></td>
              <td class="border px-4 py-2"><%= @loan_application.ownership_documents %></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>

    <!-- Step 6: Risk Assessment -->
  <% if @loan_application.borrower_risk_profile.present? %>
    <div class="bg-white shadow rounded-lg mb-4">
      <div class="flex justify-between items-center px-4 py-2 border-b">
        <h5 class="font-semibold">6. Risk Assessment</h5>
        <%= link_to "Edit", loan_application_step_path(:risk_assessment, loan_application_id: @loan_application.id), 
          class: "px-3 py-1 border border-blue-500 text-blue-500 rounded-md text-sm hover:bg-blue-50"
        %>
      </div>
      <div class="p-4 overflow-x-auto">
        <table class="w-full border border-gray-200 text-sm text-center">
          <thead class="bg-gray-200">
            <tr>
              <th class="border px-4 py-2">Borrower Risk Profile</th>
              <th class="border px-4 py-2">Loan-to-Value Ratio</th>
              <th class="border px-4 py-2">Market Conditions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border px-4 py-2"><%= @loan_application.borrower_risk_profile %></td>
              <td class="border px-4 py-2"><%= @loan_application.loan_to_value_ratio %>%</td>
              <td class="border px-4 py-2"><%= @loan_application.market_conditions %></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>

   <!-- Step 7: Loan Recommendation -->
  <% if @loan_application.recommendation_status.present? %>
    <div class="bg-white shadow rounded-lg mb-4">
      <div class="flex justify-between items-center px-4 py-2 border-b">
        <h5 class="font-semibold">7. Loan Recommendation</h5>
        <%= link_to "Edit", loan_application_step_path(:recommendation, loan_application_id: @loan_application.id), 
          class: "px-3 py-1 border border-blue-500 text-blue-500 rounded-md text-sm hover:bg-blue-50"
        %>
      </div>
      <div class="p-4 overflow-x-auto">
        <table class="w-full border border-gray-200 text-sm text-center">
          <thead class="bg-gray-200">
            <tr>
              <th class="border px-4 py-2">Recommendation Status</th>
              <th class="border px-4 py-2">Suggested Amount</th>
              <th class="border px-4 py-2">Interest Rate</th>
              <th class="border px-4 py-2">Terms</th>
              <th class="border px-4 py-2">Conditions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border px-4 py-2"><%= @loan_application.recommendation_status %></td>
              <td class="border px-4 py-2">$<%= number_with_delimiter(@loan_application.suggested_amount) if @loan_application.suggested_amount %></td>
              <td class="border px-4 py-2"><%= @loan_application.interest_rate %>%</td>
              <td class="border px-4 py-2"><%= @loan_application.terms %></td>
              <td class="border px-4 py-2"><%= @loan_application.conditions %></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>



